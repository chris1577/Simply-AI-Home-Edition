<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - simply AI</title>
    <link rel="icon" href="/static/images/favicon.png" type="image/png" />
    <!-- Only load auth.css for profile page to avoid conflicts -->
    <link rel="stylesheet" href="/static/css/auth.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body class="profile-page-body">
    <!-- Top Navigation Bar -->
    <div class="profile-top-nav">
        <div class="profile-top-nav-content">
            <h2 class="profile-page-title">
                <i class="fas fa-user-cog"></i>
                Profile
            </h2>
            <button id="back-to-chat-btn-top" class="btn-secondary btn-sm profile-back-btn">
                <i class="fas fa-comments"></i> Back to Chat
            </button>
        </div>
    </div>

    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar">
                <i class="fas fa-user"></i>
            </div>
            <h1 id="profile-username">Loading...</h1>
            <p id="profile-email" style="color: #64748b; font-size: 16px; margin: 8px 0 0 0;"></p>
        </div>

        <div class="profile-sections">
            <!-- Account Information -->
            <div class="profile-section">
                <h2><i class="fas fa-user-circle"></i> Account Information</h2>
                <div class="info-item">
                    <span class="info-label">Username</span>
                    <span class="info-value" id="info-username">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email</span>
                    <span class="info-value" id="info-email">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">User ID</span>
                    <span class="info-value" id="info-user-id">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Member Since</span>
                    <span class="info-value" id="info-created-at">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Roles</span>
                    <span class="info-value" id="info-roles">-</span>
                </div>
            </div>

            <!-- Change Password -->
            <div class="profile-section">
                <h2><i class="fas fa-key"></i> Change Password</h2>
                <form id="change-password-form" class="auth-form">
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <input type="password" id="current-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">New Password</label>
                        <input type="password" id="new-password" required minlength="8">
                        <small class="form-help">Must be at least 8 characters with uppercase, lowercase, and numbers</small>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                    <div id="password-error" class="error-message" style="display: none;"></div>
                    <div id="password-success" class="success-message" style="display: none;"></div>
                    <button type="submit" class="btn-primary btn-sm">
                        <i class="fas fa-save"></i> Change Password
                    </button>
                </form>
            </div>

            <!-- Two-Factor Authentication -->
            <div class="profile-section">
                <h2><i class="fas fa-shield-alt"></i> Two-Factor Authentication</h2>
                <div class="info-item">
                    <span class="info-label">Status</span>
                    <span class="info-value" id="twofa-status">
                        <span class="badge badge-warning">Disabled</span>
                    </span>
                </div>
                <div class="info-item" id="backup-codes-count-item" style="display: none;">
                    <span class="info-label">Backup Codes Remaining</span>
                    <span class="info-value" id="backup-codes-count">-</span>
                </div>

                <!-- 2FA Not Enabled -->
                <div id="twofa-disabled-section">
                    <p style="margin: 16px 0; color: #718096;">
                        Enable two-factor authentication to add an extra layer of security to your account.
                    </p>
                    <button id="enable-2fa-btn" class="btn-primary btn-sm">
                        <i class="fas fa-shield-alt"></i> Enable 2FA
                    </button>
                </div>

                <!-- 2FA Enrollment -->
                <div id="twofa-enrollment-section" style="display: none;">
                    <div class="qr-code-container">
                        <p><strong>Scan this QR code with your authenticator app</strong></p>
                        <p style="font-size: 13px; color: #718096; margin-bottom: 16px;">
                            (Google Authenticator, Authy, 1Password, etc.)
                        </p>
                        <img id="twofa-qr-code" alt="2FA QR Code">
                        <p style="margin-top: 16px; font-size: 12px; color: #718096;">
                            Secret Key: <code id="twofa-secret" style="background: #e2e8f0; padding: 4px 8px; border-radius: 4px;"></code>
                        </p>
                    </div>
                    <div class="form-group">
                        <label for="verification-code">Enter the 6-digit code from your app</label>
                        <input type="text" id="verification-code" maxlength="6" pattern="[0-9]{6}" inputmode="numeric" style="text-align: center; font-size: 24px; letter-spacing: 8px;">
                    </div>
                    <div id="enrollment-error" class="error-message" style="display: none;"></div>
                    <button id="verify-enrollment-btn" class="btn-primary btn-sm">
                        <i class="fas fa-check"></i> Verify & Enable 2FA
                    </button>
                    <button id="cancel-enrollment-btn" class="btn-secondary btn-sm">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>

                <!-- 2FA Enabled -->
                <div id="twofa-enabled-section" style="display: none;">
                    <p style="margin: 16px 0; color: #48bb78;">
                        <i class="fas fa-check-circle"></i> Your account is protected with two-factor authentication.
                    </p>
                    <button id="regenerate-codes-btn" class="btn-primary btn-sm" style="margin-bottom: 12px;">
                        <i class="fas fa-sync"></i> Regenerate Backup Codes
                    </button>
                    <button id="disable-2fa-btn" class="btn-danger btn-sm">
                        <i class="fas fa-shield-alt"></i> Disable 2FA
                    </button>
                </div>

                <!-- Backup Codes Display -->
                <div id="backup-codes-section" style="display: none; margin-top: 20px;">
                    <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border-left: 3px solid #f59e0b; margin-bottom: 16px;">
                        <p style="margin: 0; color: #92400e;"><strong><i class="fas fa-exclamation-triangle"></i> Important!</strong></p>
                        <p style="margin: 8px 0 0 0; color: #92400e; font-size: 13px;">
                            Save these backup codes in a secure place. Each code can only be used once if you lose access to your authenticator app.
                        </p>
                    </div>
                    <div class="backup-codes" id="backup-codes-list"></div>
                    <button id="close-backup-codes-btn" class="btn-secondary btn-sm" style="margin-top: 16px;">
                        <i class="fas fa-check"></i> I've Saved My Codes
                    </button>
                </div>
            </div>

            <!-- Admin User Management (Super Admin Only) -->
            <div class="profile-section" id="admin-user-management-section" style="display: none;">
                <h2><i class="fas fa-users-cog"></i> User Management</h2>
                <p style="color: #718096; font-size: 13px; margin-bottom: 16px;">
                    Manage user accounts. Deleting a user will permanently remove their account, chat history, and uploaded files.
                </p>
                <div id="admin-users-loading" style="text-align: center; color: #a0aec0; padding: 20px;">
                    <i class="fas fa-spinner fa-spin"></i> Loading users...
                </div>
                <div id="admin-users-error" class="error-message" style="display: none;"></div>
                <div id="admin-users-list"></div>
            </div>

            <!-- Actions -->
            <div class="profile-section">
                <h2><i class="fas fa-cog"></i> Account Actions</h2>
                <button id="export-all-chats-btn" class="btn-primary btn-sm" style="width: 100%; margin-bottom: 12px;">
                    <i class="fas fa-download"></i> Export All Chats
                </button>
                <button id="settings-link-btn" class="btn-secondary btn-sm" style="width: 100%; margin-bottom: 12px;">
                    <i class="fas fa-sliders"></i> Application Settings
                </button>
                <button id="back-to-chat-btn" class="btn-primary btn-sm" style="width: 100%; margin-bottom: 12px;">
                    <i class="fas fa-comments"></i> Back to Chat
                </button>
                <button id="logout-btn" class="btn-secondary btn-sm" style="width: 100%;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </div>

    <script src="/static/js/profile.js"></script>
</body>
</html>
